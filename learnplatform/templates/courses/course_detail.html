
{% extends 'base.html' %}

{% block title %}{{ course.title }}{% endblock %}

{% block content %}

{% load dict_extras %}

<h2>{{ course.title }}</h2>
<p>{{ course.description|linebreaks }}</p>

<h4 class="mt-4">–£—Ä–æ–∫–∏:</h4>

{% if lessons %}
    <ol class="list-group list-group-numbered">
        {% for lesson in lessons %}
            <li class="list-group-item">
                <a href="{% url 'courses:lesson_detail' course.id lesson.id %}">
                    {{ lesson.title }}
                </a>
            </li>
        {% endfor %}
    </ol>
{% else %}
    <p class="text-muted">–©–µ –Ω–µ–º–∞—î —É—Ä–æ–∫—ñ–≤.</p>
{% endif %}

{% if user.is_teacher and user == course.teacher %}
    <a href="{% url 'courses:add_lesson' course.id %}" class="btn btn-outline-primary mt-3">
        ‚ûï –î–æ–¥–∞—Ç–∏ —É—Ä–æ–∫
    </a>
{% endif %}
{% if user.is_authenticated and user.is_student and user not in course.students.all %}
    <form method="post" action="{% url 'courses:enroll' course.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary mt-3">–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –∫—É—Ä—Å</button>
    </form>
{% elif user.is_student %}
    <p class="text-success mt-3">–í–∏ –≤–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ñ –Ω–∞ —Ü–µ–π –∫—É—Ä—Å ‚úÖ</p>
{% endif %}

{% if user.is_teacher and gradebook %}
<hr class="my-5">
<h4>
    üìä –ñ—É—Ä–Ω–∞–ª —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ
    <a href="{% url 'courses:export_excel' course.id %}" class="btn btn-outline-success">
        ‚¨áÔ∏è –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –≤ Excel
    </a>
</h4>
{% endif %}

{% if gradebook %}
<table class="table table-bordered table-sm align-middle text-center">
    <thead class="table-light">
        <tr>
            <th>–°—Ç—É–¥–µ–Ω—Ç</th>
            {% for lesson in quiz_lessons %}
                <th>{{ lesson.title }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in gradebook %}
        <tr>
            <td class="text-start">{{ row.student.username }}</td>
            {% for score_obj in row.lesson_scores %}
                <td class="text-center">
                    {% if score_obj.score is not None %}
                        <span class="score fw-bold">{{ score_obj.score }}%</span>
                    {% endif %}
                    {% if score_obj.retake_request_id %}
                        <form method="post" action="{% url 'quizzes:approve_retake' score_obj.retake_request_id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-success ms-2">‚úÖ –°—Ö–≤–∞–ª–∏—Ç–∏</button>
                        </form>
                    {% elif score_obj.score is None and not score_obj.retake_request_id %}
                        <span class="text-muted">‚Äî</span>
                    {% endif %}
                </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
    <!-- –ú–æ–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—à–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
    <p>–û—Ü—ñ–Ω–∫–∏ –ø–æ–∫–∏ —â–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ñ.</p>
{% endif %}

{% endblock %}
